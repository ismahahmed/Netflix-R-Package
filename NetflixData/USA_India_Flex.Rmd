---
title: "Analyzing Netflix Content Produced in USA and India"
output: 
  flexdashboard::flex_dashboard:
    theme:
      version: 4
      bg: "#ffffff"
      fg: "#101010" 
    orientation: columns
    storyboard: true
    social: menu
    source: embed
---

```{r setup, include=FALSE}
library(flexdashboard)
library(NetflixData)
library(tidyverse)
library(ggplot2)
library(ggthemes)
library(plotly)
library(kableExtra)
library(SnowballC)
library(RColorBrewer)
library(dplyr)
library(e1071)
library(mlbench)
library(bslib)
library(ggridges)

#Text mining packages
library(tm)
library(SnowballC)
library(wordcloud)
library(RColorBrewer)
library(thematic)
```


### United States and India are the two countries that produce the most content on Netflix

```{r}
c <- country_data %>%
  count(country) %>%
  arrange(desc(n)) %>%
  na.omit() 

c %>%
  kbl(caption = "Count Of Content By Country") %>%
  kable_material_dark("striped") %>%
  scroll_box(width = "825px", height = "250px")
```


```{r}
c2 <- country_listedin %>%
  group_by(country) %>%
  filter(country %in% c("United States", "India")) %>%
  count(listed_in) %>%
  arrange(desc(n)) %>%
  na.omit()

c2 %>%
  kbl(caption = "Count Of Genre Content Produced In US & India") %>%
  kable_material_dark("striped") %>%
  scroll_box(width = "825px", height = "250px")
```

***

- The data frame is sorted from countries that produce the *most to least* Movies and TV Shows that are available on **Netflix** *since 2019*

- **3297** Movies and TV shows available on Netflix were produced in the **United States**
- **990** Movies and TV Shows available on Netflix were produced in **India**

- What kind on questions can we answer using this dataset/package?

- How does duration of movies differ in these countries?

- How do the Movies and TV Shows that are produced in these countries differ?

- What genres are popular in the United States? What genres are popular in India?

- What is the maturity rating distribution like for these two countries?

- Drama seems to be a popular genre for both the United States and India. How do these two countries describe films under the genre category?


### Duration Distribution of USA and Indian Produced Movies (all genres)

```{r}
india_duration <- dplyr::filter(netflix, grepl('India', country))
india_duration <- dplyr::filter(india_duration, grepl('Movie', type))

usa_duration <- dplyr::filter(netflix, grepl('United States', country))
usa_duration <- dplyr::filter(usa_duration, grepl('Movie', type))

fig_dur <- plot_ly(y = ~india_duration$duration, color = I("red"), type = "box", name = "India")
fig_dur <- fig_dur %>% add_trace(y = ~usa_duration$duration, color = I("black"), name = "USA")
fig_dur <- fig_dur %>% 
  layout(title = "India vs USA duration of Movie", 
        yaxis = list(title = "Duration In Minutes"))

fig_dur
```

***

- This plot shows a boxplot distribution of duration of Movies produced in India and the United States *regardless* of genre
- The majority of Indian produced movies are Bollywood produced movies and it is known that bollywood films are significantly longer than US produced films. 

- The median length for Indian produced movies that are availble on netflix is over 2 hours long while US based movies are around 1.5 hours (1 hour 30 minutes)
  - **India:** The inner quartile ranges from *1 hour and 43 minutes* to *2 hours and 21 minutes*
  - **USA:** The inner quartile ranges from *1 hour and 21 minutes* to *1 hours and 45 minutes*


### USA and India: taking a closer look at genre

```{r}
usa_listedin <- country_listedin %>%
  filter(country == "United States") %>%
  count(listed_in) %>%
  arrange(listed_in) %>%
  na.omit()

india_listedin <- country_listedin %>%
  filter(country == "India") %>%
  count(listed_in) %>%
  arrange(listed_in) %>%
  na.omit()

fig <- plot_ly(india_listedin, x = ~listed_in, y = ~n, type = 'bar', name = 'India', color = I("red"))
fig <- fig %>% add_trace(usa_listedin, x = usa_listedin$listed_in, y = usa_listedin$n , name = 'USA', color = I("black"))
fig <- fig %>% layout(xaxis = list(title = 'Genre'),yaxis = list(title = 'Count'), barmode = 'stack')
fig
```

***

- Omitting the *International Movies* genre, since movies/tvshows produced in India typically end up in this category due to location, both the United States and India produce a significant amount of Movies under the drama category

- There are **584 movies** produced in the United States that are labeled under **Drama**
- There are **611 movie** s produced in India that are labeled under **Drama**


### USA and India: Taking a closer look at maturity rating proportion distribution (regardless of genre)

```{r}
usa_countrydata <- country_data %>%
  filter(country == "United States") %>%
  group_by(country) %>%
  count(rating) %>%
  arrange(rating) %>%
  na.omit()

india_ratingdata <- country_data %>%
  filter(country == "India") %>%
  group_by(country) %>%
  count(rating) %>%
  arrange(rating) %>%
  na.omit()

india_rating_plot <- plot_ly(india_ratingdata, x = ~rating, y = ~n, type = 'bar', name = 'India', color = I("red"))
usa_rating_plot <- plot_ly(usa_countrydata, x = ~rating, y = ~n , name = 'USA', color = I("black"))
subplot(india_rating_plot, usa_rating_plot) 
```

***

- From my understanding, and from the movies I've watched, India typically produces movies that are more family friendly so it makes sense that the most popular rating is TV-14

- United States typically produce more movies and tv shows that are more mature however there is a wider variety on content type when comparing it to India. This may be because Netflix was founded in the US which makes the avaiale content steer more towards US-based produced content

### Most Frequent Description Words for Dramas Produced In India

```{r}
india_wordcloud_data <- dplyr::filter(netflix, grepl('Dramas', listed_in))
india_wordcloud_data <- dplyr::filter(india_wordcloud_data, grepl('India', country))

corpus = Corpus(VectorSource(india_wordcloud_data$description))
corpus = tm_map(corpus, PlainTextDocument)
corpus = tm_map(corpus, tolower)
corpus = tm_map(corpus, removePunctuation)
corpus = tm_map(corpus, removeWords, c("cloth", stopwords("english")))
corpus = tm_map(corpus, stripWhitespace)

dtm <- TermDocumentMatrix(corpus)
m <- as.matrix(dtm)
v <- sort(rowSums(m),decreasing=TRUE)
india_data <- data.frame(word = names(v),freq=v)

usa_wordcloud_data <- dplyr::filter(netflix, grepl('Dramas', listed_in))
usa_wordcloud_data <- dplyr::filter(usa_wordcloud_data, grepl('United States', country))

corpus2 = Corpus(VectorSource(usa_wordcloud_data$description))
corpus2 = tm_map(corpus2, PlainTextDocument)
corpus2 = tm_map(corpus2, tolower)
corpus2 = tm_map(corpus2, removePunctuation)
corpus2 = tm_map(corpus2, removeWords, c("cloth", stopwords("english")))
corpus2 = tm_map(corpus2, stripWhitespace)

dtm2 <- TermDocumentMatrix(corpus2)
m2 <- as.matrix(dtm2)
v2 <- sort(rowSums(m2),decreasing=TRUE)
usa_data <- data.frame(word = names(v2),freq=v2)
```

```{r}
set.seed(4)
barplot(india_data[1:10,]$freq, las = 2, names.arg = india_data[1:10,]$word,
        col ="red", main ="Most Frequent Desription Words for Dramas In India",
        ylab = "Word frequencies")
w <- wordcloud(words = india_data$word, freq = india_data$freq, min.freq = 10,
          max.words=25, random.order=FALSE, rot.per=0.35, 
          colors=brewer.pal(10, "Dark2"))
```

***

- Most movies that are produced in Bollywood typically geer towards romance so I am not surprised that "Love" is a popular description word


### Most Frequent Description Words for Dramas Produced In USA

```{r}
set.seed(4)
barplot(usa_data[1:10,]$freq, las = 2, names.arg = usa_data[1:10,]$word,
        col ="black", main ="Most Frequent Description Words for Dramas In USA",
        ylab = "Word frequencies")
w2 <- wordcloud(words = usa_data$word, freq = usa_data$freq, min.freq = 10,
          max.words=25, random.order=FALSE, rot.per=0.35, 
          colors=brewer.pal(10, "Dark2"))
```

***

- The word "young" the the number one most popular describer word for both US and Indian dram movies

### Duration Distribution of USA and Indian Produced Drama Movies

```{r}
india_duration_drama <- dplyr::filter(netflix, grepl('India', country))
india_duration_drama <- dplyr::filter(india_duration_drama, grepl('Dramas', listed_in))
india_duration_drama <- dplyr::filter(india_duration_drama, grepl('Movie', type))

usa_duration_drama <- dplyr::filter(netflix, grepl('United States', country))
usa_duration_drama <- dplyr::filter(usa_duration_drama, grepl('Dramas', listed_in))
usa_duration_drama <- dplyr::filter(usa_duration_drama, grepl('Movie', type))

fig_dur_drama <- plot_ly(y = ~india_duration_drama$duration, color = I("red"), type = "box", name = "India")
fig_dur_drama <- fig_dur_drama %>% add_trace(y = ~usa_duration_drama$duration, color = I("black"), name = "USA")
fig_dur_drama <- fig_dur_drama %>% 
  layout(title = "India VS USA Duration Of Drama Movies", 
         yaxis = list(title = "Duration In Minutes"))

fig_dur_drama

```

***

- I went back and did another boxplot of duration of India and USA produced movies but this time under the Drama category. I found that the distributions were similar


### Duration Across Genres

```{r}
india_duration2 <- dplyr::filter(netflix, grepl('India', country))
india_duration2 <- dplyr::filter(india_duration2, grepl('Movie', type))

indiadensity <- ggplot(india_duration2, 
       aes(x = duration, 
           y = rating, 
           fill = rating)) +
  geom_density_ridges() + 
  theme_few() +
  labs(title = "India Movie Duration Distribution", x = "Duration in Minutes", y = "Maturity Rating") +
  theme(legend.position = "none")

usa_duration2 <- dplyr::filter(netflix, grepl('United States', country))
usa_duration2 <- dplyr::filter(usa_duration2, grepl('Movie', type))

usadensity <- ggplot(usa_duration2, 
       aes(x = duration, 
           y = rating, 
           fill = rating)) +
  geom_density_ridges() + 
  theme_few() +
  labs(title = "United States Movie Duration Distribution", x = "Duration in Minutes", y = "Maturity Rating") +
  theme(legend.position = "none")

require(gridExtra)
gridExtra::grid.arrange(indiadensity, usadensity)
```

***

- I went and did a quick density plot using geomridges 
